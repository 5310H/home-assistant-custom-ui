<!-- This file assumes that the following are already imported by Homeassistant
<link rel="import" href="../../bower_components/polymer/polymer.html">
-->
<link rel="import" href="state-card-with-slider.html" async>


<dom-module id="state-card-custom_light">
  <template>
    <style>
      .container {
        position: relative;
      }
      .extra {
        position: absolute;
	right: 0;
	top: -8px;
	pointer-events: none;
      }
    </style>
    <div class='container'>
      <template is='dom-if' if='[[extra]]'>
        <div class='extra'>[[extra]]</div>
      </template>
      <state-card-with-slider
          hass='[[hass]]'
          in-dialog='[[inDialog]]'
       	  state-obj='[[stateObj]]'
       	  control-element='ha-entity-toggle'
	  domain='light'
	  service-min='turn_off'
	  service-max='turn_on'
	  value-name='brightness'></state-card-with-slider>
    </div>
  </template>
</dom-module>

<script>
Polymer({
  is: 'state-card-custom_light',

  properties: {
    hass: {
      type: Object,
    },
    inDialog: {
      type: Boolean,
      value: false,
    },
    stateObj: {
      type: Object,
    },
    extra: {
      type: String,
      computed: 'computeExtra(stateObj, inDialog)',
    },
  },

  computeExtra: function (stateObj, inDialog) {
    if (!inDialog && stateObj.attributes.extra_data_template) {
      var errorsFound = false;
      var result = stateObj.attributes.extra_data_template.replace(
          /{([^}!]+)(!=)?([^}]+)?}/g,
          function (match, p1, p2, p3) {
            if (!stateObj.attributes[p1] || (p2 && stateObj.attributes[p1] === p3)) {
              errorsFound = true;
              return '';
            }
            return stateObj.attributes[p1];
          });
      if (errorsFound) return null;
      return result;
    }
    return null;
  },
});
</script>
